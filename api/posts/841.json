{"title":"流量包分析","slug":"流量包分析","date":"2021-02-20","updated":"2021-02-20","comments":true,"path":"api/posts/841.json","excerpt":null,"cover":"../images/image-20210220204230391.png","covers":["../images/image-20210220204230391.png","../images/image-20210220204306714.png","../images/image-20210220204333754.png","../images/image-20210220204625068.png","../images/image-20210220204707301.png","../images/image-20210220204830658.png","../images/image-20210220205000905.png","../images/image-20210220205019963.png","../images/image-20210220204014794.png","../images/image-20210220204138581.png"],"content":"<h1 id=\"流量包分析\"><a href=\"# 流量包分析\" class=\"headerlink\" title=\"流量包分析\"></a>流量包分析 </h1><h2 id=\"互联网五层模型\"><a href=\"# 互联网五层模型\" class=\"headerlink\" title=\"互联网五层模型\"></a> 互联网五层模型 </h2><p> 防火墙截取的网络攻击流在公安机关对网络攻击的取证中，流量分析往往是非常重要的一个环节，通过分析 <br> 量，我们能获得许多线索。在学习流量分析之前，我们需要明白一些网络的基础知识，</p>\n<p>我们将从常见的网络五层模型，自下而上，即物理层 -&gt; 数据 <br> 链路层 -&gt; 网络层 -&gt; 传输层 -&gt; 应用层 </p>\n<table>\n<thead>\n<tr>\n<th>应用层</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>传输层</td>\n</tr>\n<tr>\n<td>网络层</td>\n</tr>\n<tr>\n<td>数据链路层</td>\n</tr>\n<tr>\n<td>物理层</td>\n</tr>\n</tbody></table>\n<h3 id=\"物理层\"><a href=\"# 物理层\" class=\"headerlink\" title=\"物理层\"></a>物理层</h3><p><img src=\"../images/image-20210220204230391.png\" alt=\"image-20210220204230391\"></p>\n<p>当两台计算机相连直接通信的时候，发挥主要作用的是物理层。<br>计算机将信号发送到网线上，另外一台计算机负责接收。<br>假如我们将第三台电脑通过集线器（hub）相连，相当于三台计算机 <br> 同时连接在同一根导线上，一台计算机发送的信号，会被其他两台 <br> 计算机同时收到，不够安全，也有可能发生信号冲突。</p>\n<p><img src=\"../images/image-20210220204306714.png\" alt=\"image-20210220204306714\"></p>\n<h3 id=\"数据链路层\"><a href=\"# 数据链路层\" class=\"headerlink\" title=\"数据链路层\"></a>数据链路层 </h3><p> 当多台计算机通过交换机（switch）相连的时候，他们采用的通信方式是数据链路层的协议，如下图所示，每一台计算机都分配了对应的 MAC 地址，当某台计算机想通过给另外一个计算机发送消息时，需要在以太帧头中指明发送方和接收方的地址，交换机在接收到信号之后会根据这个地址正确将信号转发至某一端口（即网线），从而避免了网络内所有计算机都能收到信号。以太帧中的数据包是我们想要传输的信息，包括接下来的 IP 数据包</p>\n<p><img src=\"../images/image-20210220204333754.png\" alt=\"image-20210220204333754\"><img src=\"../images/image-20210220204343627.png\" alt=\"image-20210220204343627\"></p>\n<h3 id=\"网络层\"><a href=\"# 网络层\" class=\"headerlink\" title=\"网络层\"></a>网络层 </h3><p> 当我们计算机的网络较为大且复杂的时候，我们使用简单的 MAC 地址并不能很好的管理网络，因为 MAC 地址是和硬件绑定的，因为假如我们更换了计算机设备，那么就需要重新配置网络的信息。这个时候 IP 地址网络协议就诞生了。<br>IP 地址和 MAC 地址通过 Arp 协议进行转换。其中路由器的存在使得计算机之间能够跨网段访问。如图所示的网络的三个区域的网段分别是 192.168.0.0/24、 192.168.1.0/24、 192.168.2.0/24，网关则是路由器连接每个网段的接口，比如 192.168.0.1、192.168.1.1、192.168.2.1，计算机想要跨网段通信时，需要把消息转发给路由器上面的网关，路由器再根据 IP 地址接着转发。<br>下图是 arp 协议将物理地址转化为网络地址。</p>\n<p><img src=\"../images/image-20210220204625068.png\" alt=\"image-20210220204625068\"></p>\n<p>如下图所示，这个是网络层的 IP 数据包部分，里面指明了源地址和目的地址，IP 地址里面的 <br> 数据包包含了我们想要传输的信息，如 TCP 数据包。</p>\n<p><img src=\"../images/image-20210220204707301.png\" alt=\"image-20210220204707301\"></p>\n<h3 id=\"传输层\"><a href=\"# 传输层\" class=\"headerlink\" title=\"传输层\"></a>传输层 </h3><p> 在网络层的基础上，我们完成了数据通过 IP 地址的传送，但是我们仍然要确保数据传输 <br> 的可靠性。Tcp 就是这样的一种协议，他具有多种特性，如使用三次握手的方法确保连接 <br> 畅通，通过端口的方法来区分不同的连接。</p>\n<p>大致流程如下：<br>客户端向服务端发送一个请求连接包 ，标识符为 SYN 序号为 J<br>服务端、收到请求连接包，并对 SYN J 进行确认，然后发送一个回复包，标识符为 SYN K, ACK J+1<br>客户端向服务端发一个确认收到回复包，标识符为 ACK K+1<br>这样就完成了三次握手。、<img src=\"../images/image-20210220204830658.png\" alt=\"image-20210220204830658\"></p>\n<p>三次握手在 wireshark 中抓包如下：</p>\n<p><img src=\"../images/image-20210220205000905.png\" alt=\"image-20210220205000905\"></p>\n<p><img src=\"../images/image-20210220205019963.png\" alt=\"image-20210220205019963\"></p>\n<p>输层还有一种协议是 UDP 协议，是不可靠连接，是不能确定对方是否收到的一种数据包 <br> 格式如下：</p>\n<h2 id=\"Wireshark 的基本\"><a href=\"#Wireshark 的基本\" class=\"headerlink\" title=\"Wireshark 的基本\"></a>Wireshark 的基本 </h2><h2 id=\"使用\"><a href=\"# 使用\" class=\"headerlink\" title=\"使用\"></a> 使用 </h2><p> 进入 wireshark，首先选择需要监听的网卡</p>\n<p><img src=\"../images/image-20210220204014794.png\" alt=\"image-20210220204014794\"></p>\n<p>之后 wireshark 会进入监听状态，我们可以点击其中任意一个数据包查看相关数据内容</p>\n<p><img src=\"../images/image-20210220204138581.png\" alt=\"image-20210220204138581\"></p>\n","url":"/posts/841/","min2read":3,"word4post":"1.1k","prev_post":null,"next_post":{"title":"数据编码","url":"/posts/43878/"},"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" data-id=\"流量包分析\" href = \"#\"><span class=\"toc-number\">1.</span> <span class=\"toc-text\">流量包分析 </span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"互联网五层模型\" href = \"#\"><span class=\"toc-number\">1.1.</span> <span class=\"toc-text\"> 互联网五层模型 </span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" data-id=\"物理层\" href = \"#\"><span class=\"toc-number\">1.1.1.</span> <span class=\"toc-text\">物理层</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" data-id=\"数据链路层\" href = \"#\"><span class=\"toc-number\">1.1.2.</span> <span class=\"toc-text\">数据链路层 </span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" data-id=\"网络层\" href = \"#\"><span class=\"toc-number\">1.1.3.</span> <span class=\"toc-text\">网络层 </span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" data-id=\"传输层\" href = \"#\"><span class=\"toc-number\">1.1.4.</span> <span class=\"toc-text\">传输层 </span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"Wireshark 的基本\" href = \"#\"><span class=\"toc-number\">1.2.</span> <span class=\"toc-text\">Wireshark 的基本 </span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"使用\" href = \"#\"><span class=\"toc-number\">1.3.</span> <span class=\"toc-text\"> 使用 </span></a></li></ol></li></ol>","categories":[],"tags":[]}